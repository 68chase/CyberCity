<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Johnny Mnemonic XR Controller Demo</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.163/build/three.module.js';
import { VRButton } from 'https://cdn.jsdelivr.net/npm/three@0.163/examples/jsm/webxr/VRButton.js';

let scene, camera, renderer, cube;
let controller1, controller2;

init();
animate();

function init() {
  // Scene
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x000000);

  // Camera
  camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 100);
  camera.position.z = 3;

  // Renderer
  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.xr.enabled = true;
  document.body.appendChild(renderer.domElement);
  document.body.appendChild(VRButton.createButton(renderer));

  // Light
  const light = new THREE.HemisphereLight(0xffffff, 0x444444);
  light.position.set(0, 20, 0);
  scene.add(light);

  // Test cube
  const geometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
  const material = new THREE.MeshStandardMaterial({ color: 0x00ffcc });
  cube = new THREE.Mesh(geometry, material);
  cube.position.set(0, 1.5, -2);
  scene.add(cube);

  // Controllers
  controller1 = renderer.xr.getController(0);
  controller2 = renderer.xr.getController(1);

  // Visual indicator for controllers
  const controllerGeometry = new THREE.SphereGeometry(0.02, 16, 16);
  const controllerMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
  const controllerMesh1 = new THREE.Mesh(controllerGeometry, controllerMaterial);
  const controllerMesh2 = new THREE.Mesh(controllerGeometry, controllerMaterial.clone());

  controller1.add(controllerMesh1);
  controller2.add(controllerMesh2);
  scene.add(controller1);
  scene.add(controller2);

  // Simple event logging
  controller1.addEventListener('selectstart', onSelectStart);
  controller1.addEventListener('selectend', onSelectEnd);
  controller2.addEventListener('selectstart', onSelectStart);
  controller2.addEventListener('selectend', onSelectEnd);

  window.addEventListener('resize', onWindowResize);
}

function onSelectStart(event) {
  console.log('Select started on controller', event.target);
  cube.material.color.set(0xff0000); // flash cube red
}

function onSelectEnd(event) {
  console.log('Select ended on controller', event.target);
  cube.material.color.set(0x00ffcc); // back to original color
}

function onWindowResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
  renderer.setAnimationLoop(renderScene);
}

function renderScene() {
  cube.rotation.x += 0.01;
  cube.rotation.y += 0.01;
  renderer.render(scene, camera);
}
</script>
</body>
</html>